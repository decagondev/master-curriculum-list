<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Module 4 - RTK Query</title>
    <style>
        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Oxygen, Ubuntu, Cantarell, 'Open Sans', 'Helvetica Neue', sans-serif;
            line-height: 1.6;
            margin: 0;
            padding: 20px;
            background-color: #1a1d23; /* Dark background color */
            color: #ffffff;
        }
        .container {
            max-width: 1200px;
            margin: 0 auto;
            background-color: #222831; /* Darker container background */
            padding: 30px;
            border-radius: 8px;
            box-shadow: 0 2px 4px rgba(0,0,0,0.3);
        }
        h1, h2, h3, h4 {
            color: #ffffff;
            margin: 0;
        }
        h1 {
            color: #ffffff;
            margin-bottom: 30px;
            border-bottom: 2px solid #ff5722; /* Orange accent color */
            padding-bottom: 10px;
        }
        h2 {
            color: #ffffff;
            margin-top: 30px;
            margin-bottom: 20px;
        }
        h3 {
            color: #ff5722; /* Orange accent color */
            margin-top: 0;
        }
        h4 {
            color: #ffffff;
            margin-top: 1.5rem;
            margin-bottom: 1rem;
        }
        .section {
            margin-bottom: 40px;
            background-color: #2a303c;
            border-radius: 4px;
            padding: 20px;
            border: 1px solid #333a47;
        }
        .section p, .section li {
            color: #b3b3b3;
        }
        ul {
            color: #b3b3b3;
            padding-left: 20px;
        }
        li {
            margin-bottom: 10px;
        }
        .button {
            display: inline-block;
            padding: 8px 16px;
            background-color: #ff5722; /* Orange accent color */
            color: white;
            text-decoration: none;
            border-radius: 4px;
            transition: background-color 0.2s;
        }
        .button:hover {
            background-color: #ff7043; /* Lighter orange on hover */
            box-shadow: 0 0 10px rgba(255, 87, 34, 0.5);
        }
        .resources {
            background-color: #333a47;
            border-radius: 4px;
            padding: 20px;
            margin-top: 15px;
        }
        .resources ul {
            list-style-type: none;
            padding: 0;
        }
        .resources li {
            margin-bottom: 10px;
            color: #b3b3b3;
        }
        .resources a {
            color: #ff5722; /* Orange accent color */
            text-decoration: none;
        }
        .resources a:hover {
            text-decoration: underline;
            color: #ff7043; /* Lighter orange on hover */
        }
        
        /* Navigation styling */
        nav {
            margin-bottom: 30px;
        }
        nav ul {
            list-style: none;
            display: flex;
            flex-wrap: wrap;
            gap: 1rem;
            padding: 0;
            margin-top: 20px;
        }
        nav a {
            display: inline-block;
            padding: 8px 16px;
            background-color: #333a47;
            color: white;
            text-decoration: none;
            border-radius: 4px;
            transition: background-color 0.3s;
        }
        nav a:hover {
            background-color: #ff5722;
            box-shadow: 0 0 10px rgba(255, 87, 34, 0.5);
        }
        
        /* Video container styling */
        .video-container {
            margin-bottom: 2rem;
            background-color: #333a47;
            border-radius: 6px;
            padding: 1.5rem;
            border: 1px solid #444c5c;
        }
        .video-container h3 {
            margin-bottom: 1rem;
        }
        .wistia_embed {
            width: 100%;
            height: 360px;
            border: none;
            border-radius: 4px;
            margin-top: 10px;
        }
        
        /* Media queries */
        @media (max-width: 768px) {
            nav ul {
                flex-direction: column;
                gap: 0.5rem;
            }
            .wistia_embed {
                height: 240px;
            }
        }
        
        /* Code block styling - enhanced */
        pre {
            background-color: #1a1d23 !important;
            color: #b3b3b3;
            padding: 15px !important;
            border-radius: 4px;
            overflow-x: auto;
            font-family: 'Courier New', Courier, monospace;
            margin: 15px 0;
            border-left: 3px solid #ff5722;
            line-height: 1.5;
        }
        pre code {
            color: #b3b3b3;
            font-size: 14px;
        }
    </style>
</head>
<body>
    <div class="container">
        <h1>Web Unit 3 Sprint 10 - Redux & State Management</h1>

        <div class="section">
            <h2>Module 4: RTK Query</h2>
            <p>In this module, you'll learn about RTK Query, a powerful data fetching and caching tool built into Redux Toolkit. You'll explore how to create and use queries, handle mutations, and effectively manage server state in your applications.</p>
        </div>

        <div class="section">
            <h2>Learning Objectives</h2>
            <ul>
                <li>Understand RTK Query and its benefits</li>
                <li>Set up RTK Query in a Redux application</li>
                <li>Create and use queries to fetch data</li>
                <li>Create and use mutations to modify data</li>
                <li>Effectively use tags for cache invalidation</li>
                <li>Monitor and handle request states</li>
            </ul>
        </div>

        <div class="section">
            <h2>Content</h2>
            
            <div class="video-container">
                <h3>Understanding RTK Query</h3>
                <iframe src="https://fast.wistia.net/embed/iframe/8p96nwphv3" title="Understanding RTK Query" allow="autoplay; fullscreen" frameborder="0" scrolling="no" class="wistia_embed" name="wistia_embed" width="100%" height="100%" loading="lazy"></iframe>
                
                <div class="resources">
                    <h4>What is RTK Query?</h4>
                    <p>RTK Query is a powerful data fetching and caching solution that is part of the Redux Toolkit. It provides a streamlined API to simplify asynchronous data fetching, caching, and state management in React applications.</p>
                    
                    <h4>Why RTK Query?</h4>
                    <p>RTK Query offers several advantages that make it an excellent choice for managing server state:</p>
                    
                    <ul>
                        <li><strong>Simplified Data Fetching</strong>: No more manually setting up actions, reducers, and middleware for each API request. RTK Query abstracts these complexities, letting you declare what data you need, not how to fetch it.</li>
                        
                        <li><strong>Built-in Caching and Automatic Refetching</strong>: RTK Query automatically caches your data and provides intelligent re-fetching, optimizing your application's performance and reducing unnecessary network requests.</li>
                        
                        <li><strong>Seamless Integration with Redux</strong>: As part of Redux Toolkit, RTK Query integrates perfectly with the Redux ecosystem, allowing for centralized state management.</li>
                        
                        <li><strong>Streamlined State Management</strong>: RTK Query manages loading states and error handling, freeing developers to focus on building features.</li>
                    </ul>
                    
                    <p>RTK Query acts as a middleware between your React application and your backend APIs, replacing manual fetch calls and state management with hooks that handle the entire lifecycle of API calls.</p>
                </div>
            </div>

            <div class="video-container">
                <h3>Setting Up RTK Query</h3>
                <iframe src="https://fast.wistia.net/embed/iframe/sw6iebwxba" title="Setting Up RTK Query" allow="autoplay; fullscreen" frameborder="0" scrolling="no" class="wistia_embed" name="wistia_embed" width="100%" height="100%" loading="lazy"></iframe>
                
                <div class="resources">
                    <h4>Setting Up the API Service</h4>
                    <p>The first step in using RTK Query is to create an API slice using the <code>createApi</code> function. This slice will define how your application interacts with your API.</p>
                    
                    <pre style="background-color: #333a47; color: #b3b3b3; padding: 10px; border-radius: 4px; overflow-x: auto;">
// usersApi.js
import { createApi, fetchBaseQuery } from '@reduxjs/toolkit/query/react'

// The usersApi slice - handling API interactions for user data
export const usersApi = createApi({
  // Unique key that defines where the data will be stored in Redux state
  reducerPath: 'usersApi',
  
  // Setting up the base query with the base URL pointing to the backend service
  baseQuery: fetchBaseQuery({ baseUrl: 'http://localhost:9009/api/' }),
  
  // Endpoints will be defined here in future steps
  endpoints: (builder) => ({})
});</pre>
                    
                    <h4>Integrating the API Service with the Store</h4>
                    <p>Once you've created your API slice, you need to integrate it with your Redux store:</p>
                    
                    <pre style="background-color: #333a47; color: #b3b3b3; padding: 10px; border-radius: 4px; overflow-x: auto;">
// store.js
import { configureStore } from '@reduxjs/toolkit'
import { usersApi } from './usersApi'

// Configuring the Redux store, adding our API slice and middleware
export const store = configureStore({
  // The root reducer object where we mount our slice reducers
  reducer: {
    // Mounting the API reducer under a dynamic key
    [usersApi.reducerPath]: usersApi.reducer,
  },
  
  // Customizing the store's middleware chain
  middleware: (getDefaultMiddleware) =>
    // Adding the API middleware to the default middleware chain
    getDefaultMiddleware().concat(usersApi.middleware),
});</pre>
                    
                    <p>This setup injects RTK Query's capabilities into your Redux store, allowing it to manage server state alongside your client state.</p>
                </div>
            </div>

            <div class="video-container">
                <h3>Creating Queries</h3>
                <iframe src="https://fast.wistia.net/embed/iframe/859bepz3iy" title="Creating Queries" allow="autoplay; fullscreen" frameborder="0" scrolling="no" class="wistia_embed" name="wistia_embed" width="100%" height="100%" loading="lazy"></iframe>
                
                <div class="resources">
                    <h4>Defining Endpoints</h4>
                    <p>After setting up the API service, you need to define endpoints that correspond to API operations:</p>
                    
                    <pre style="background-color: #333a47; color: #b3b3b3; padding: 10px; border-radius: 4px; overflow-x: auto;">
// usersApi.js (continued from above)
export const usersApi = createApi({
  reducerPath: 'usersApi',
  baseQuery: fetchBaseQuery({ baseUrl: 'http://localhost:9009/api/' }),
  endpoints: (builder) => ({
    // Query endpoint to fetch all users
    getUsers: builder.query({
      query: () => 'users',
    }),
    
    // Query endpoint to fetch a single user by ID
    getUserById: builder.query({
      query: (userId) => `users/${userId}`,
    }),
  }),
});

// Export the auto-generated hooks
export const { useGetUsersQuery, useGetUserByIdQuery } = usersApi;</pre>
                    
                    <h4>Using Query Hooks in Components</h4>
                    <p>RTK Query auto-generates hooks for each endpoint that you can use directly in your components:</p>
                    
                    <pre style="background-color: #333a47; color: #b3b3b3; padding: 10px; border-radius: 4px; overflow-x: auto;">
// UsersList.js
import React from 'react';
import { useGetUsersQuery } from './usersApi';

function UsersList() {
  // The hook provides data and loading/error states
  const { data: users, isLoading, isError, error } = useGetUsersQuery();

  if (isLoading) {
    return &lt;div&gt;Loading users...&lt;/div&gt;;
  }

  if (isError) {
    return &lt;div&gt;Error loading users: {error.message}&lt;/div&gt;;
  }

  return (
    &lt;div&gt;
      &lt;h2&gt;Users&lt;/h2&gt;
      &lt;ul&gt;
        {users.map(user =&gt; (
          &lt;li key={user.id}&gt;{user.name}&lt;/li&gt;
        ))}
      &lt;/ul&gt;
    &lt;/div&gt;
  );
}</pre>
                </div>
            </div>

            <div class="video-container">
                <h3>Using Tags</h3>
                <iframe src="https://fast.wistia.net/embed/iframe/nggaw17zwr" title="Using Tags" allow="autoplay; fullscreen" frameborder="0" scrolling="no" class="wistia_embed" name="wistia_embed" width="100%" height="100%" loading="lazy"></iframe>
                
                <div class="resources">
                    <h4>Cache Invalidation with Tags</h4>
                    <p>RTK Query uses tags to manage cache invalidation. Tags allow you to mark which queries should be refetched when mutations occur:</p>
                    
                    <pre style="background-color: #333a47; color: #b3b3b3; padding: 10px; border-radius: 4px; overflow-x: auto;">
// usersApi.js with tags
export const usersApi = createApi({
  reducerPath: 'usersApi',
  baseQuery: fetchBaseQuery({ baseUrl: 'http://localhost:9009/api/' }),
  tagTypes: ['User'],  // Define tag types
  endpoints: (builder) => ({
    getUsers: builder.query({
      query: () => 'users',
      // Provide tags to this query
      providesTags: ['User'],
    }),
    
    getUserById: builder.query({
      query: (userId) => `users/${userId}`,
      // Provide a specific tag for each user
      providesTags: (result, error, userId) => [{ type: 'User', id: userId }],
    }),
    
    // Mutation to add a new user
    addUser: builder.mutation({
      query: (newUser) => ({
        url: 'users',
        method: 'POST',
        body: newUser,
      }),
      // Invalidate the User tag to trigger refetching
      invalidatesTags: ['User'],
    }),
  }),
});

export const { 
  useGetUsersQuery, 
  useGetUserByIdQuery,
  useAddUserMutation 
} = usersApi;</pre>
                    
                    <p>With this setup, whenever the <code>addUser</code> mutation is executed, any query with the <code>User</code> tag will be automatically refetched, ensuring your UI stays in sync with the server data.</p>
                </div>
            </div>

            <div class="video-container">
                <h3>Monitoring Requests</h3>
                <iframe src="https://fast.wistia.net/embed/iframe/3ilmf2knxr" title="Monitoring Requests" allow="autoplay; fullscreen" frameborder="0" scrolling="no" class="wistia_embed" name="wistia_embed" width="100%" height="100%" loading="lazy"></iframe>
                
                <div class="resources">
                    <h4>Handling Request States</h4>
                    <p>RTK Query provides comprehensive request state management, allowing you to easily handle loading, success, and error states in your UI:</p>
                    
                    <pre style="background-color: #333a47; color: #b3b3b3; padding: 10px; border-radius: 4px; overflow-x: auto;">
// UserForm.js
import React, { useState } from 'react';
import { useAddUserMutation } from './usersApi';

function UserForm() {
  const [name, setName] = useState('');
  const [email, setEmail] = useState('');
  
  // The mutation hook returns an array with the trigger function and result object
  const [addUser, { isLoading, isSuccess, isError, error }] = useAddUserMutation();
  
  const handleSubmit = async (e) => {
    e.preventDefault();
    try {
      // Trigger the mutation
      await addUser({ name, email });
      // Clear form on success
      setName('');
      setEmail('');
    } catch (err) {
      // Error is handled by RTK Query
      console.error('Failed to add user:', err);
    }
  };
  
  return (
    &lt;div&gt;
      &lt;h2&gt;Add New User&lt;/h2&gt;
      {isSuccess && &lt;p className="success"&gt;User added successfully!&lt;/p&gt;}
      {isError && &lt;p className="error"&gt;Error: {error.message}&lt;/p&gt;}
      
      &lt;form onSubmit={handleSubmit}&gt;
        &lt;div&gt;
          &lt;label htmlFor="name"&gt;Name:&lt;/label&gt;
          &lt;input
            id="name"
            value={name}
            onChange={(e) =&gt; setName(e.target.value)}
            disabled={isLoading}
          /&gt;
        &lt;/div&gt;
        &lt;div&gt;
          &lt;label htmlFor="email"&gt;Email:&lt;/label&gt;
          &lt;input
            id="email"
            value={email}
            onChange={(e) =&gt; setEmail(e.target.value)}
            disabled={isLoading}
          /&gt;
        &lt;/div&gt;
        &lt;button type="submit" disabled={isLoading}&gt;
          {isLoading ? 'Adding...' : 'Add User'}
        &lt;/button&gt;
      &lt;/form&gt;
    &lt;/div&gt;
  );
}</pre>
                    
                    <p>RTK Query also provides additional properties like <code>isFetching</code> (for subsequent requests), <code>refetch</code> (to manually trigger refetching), and <code>data</code> (the cached response), making it a complete solution for API state management.</p>
                </div>
            </div>
        </div>

        <div class="section">
            <h2>Practice Activities</h2>
            <div class="resources">
                <h4>Guided Project</h4>
                <ul>
                    <li><a href="https://github.com/bloominstituteoftechnology/web-guided-project-redux-toolkit" target="_blank">Redux Toolkit Guided Project</a></li>
                </ul>
                <h4>Project Solution</h4>
                <ul>
                    <li><a href="https://github.com/bloominstituteoftechnology/web-module-project-async-redux" target="_blank">Async Redux Project</a></li>
                </ul>
            </div>
        </div>

        <div class="section">
            <h2>Additional Resources</h2>
            <div class="resources">
                <ul>
                    <li><a href="https://redux-toolkit.js.org/rtk-query/overview" target="_blank">RTK Query Official Documentation</a></li>
                    <li><a href="https://redux-toolkit.js.org/rtk-query/usage/queries" target="_blank">RTK Query - Queries</a></li>
                    <li><a href="https://redux-toolkit.js.org/rtk-query/usage/mutations" target="_blank">RTK Query - Mutations</a></li>
                    <li><a href="https://redux-toolkit.js.org/rtk-query/usage/cache-behavior" target="_blank">RTK Query - Cache Behavior</a></li>
                    <li><a href="https://redux-toolkit.js.org/tutorials/rtk-query" target="_blank">RTK Query Quick Start Tutorial</a></li>
                </ul>
            </div>
        </div>
    </div>
</body>
</html> 