<html>
<head>
<meta http-equiv="Content-Type" content="text/html; charset=utf-8"/>
<title>Objective 2 - Deploy a Web-API to Heroku</title>
<meta name="identifier" content="g64bd32106f97058edd1b0ce45a665110"/>
<meta name="editing_roles" content="teachers"/>
<meta name="workflow_state" content="active"/>
</head>
<body>
<p>&nbsp;</p>
<p><iframe class="wistia_embed" title="Heroku Deployment Video" src="https://fast.wistia.net/embed/iframe/n63bbv8ubc" width="640" height="360" name="wistia_embed" allow="autoplay; fullscreen" loading="lazy"></iframe></p>
<p>&nbsp;</p>
<h2 id="overview">Overview</h2>
<p><span>In this lesson, we'll deploy an Express API to Heroku.</span> Heroku is the most pragmatic service for deploying a full-stack personal project for potential employers to see. However, <strong>as of November 2022 Heroku does not provide a totally free tier</strong> like they used to, so we do not expect you to use their services. We only need you to understand how to make an API deployable to Heroku or similar providers.</p>
<h2 id="follow-along">Follow Along</h2>
<h3 id="starter-code">Starter Code</h3>
<p>This tutorial works with <a href="https://github.com/BloomInstituteOfTechnology/node-api4-guided-solution">this repository</a>. It contains an Express server that is <em>deployable</em> thanks to two key features:</p>
<ul>
<li>It contains a "start" script that launches server with Node (not Nodemon).</li>
<li>The port number is pulled from the environment, instead of it being hard-coded in the file.</li>
</ul>
<h3 id="setup-continuous-deployment-from-github">Setup Continuous Deployment from GitHub</h3>
<ul>
<li>Login to Heroku and create an app.</li>
<li>In the "Deploy" tab, select <em>GitHub</em> in the "Deployment Method" section.</li>
<li>Heroku will ask GitHub for authorization to access. You need to approve access.</li>
<li>Search for the repository you wish to deploy and click <em>Connect</em>. You can use a fork of the repo linked above.</li>
<li>In the "Automatic deploys" section, pick the "main" branch and click "Enable Automatic Deploys".</li>
<li>In the "Manual deploy" section, click on "Deploy Branch" to kick-start the first deployment.</li>
<li>Scroll to the top and move to the "Overview" tab to see the deployment in action.</li>
<li>On the top right, click "Open App".</li>
</ul>
<p>The deployment succeeded! If upon opening you app you encounter an error, <strong>make sure to have a "start" script in the <code>package.json</code> and to pull the port number from <code>process.env</code></strong>.</p>
<p><span>Use Postman to connect to the API and get some data.</span></p>
<h2 id="add-an-environment-variable-on-heroku">Add an Environment Variable on Heroku</h2>
<ul>
<li aria-level="1"><span>Change the GET endpoint to greet a friend whose name is pulled from the environment of the machine.</span></li>
</ul>
<div>
<pre style="background: none 0% 0% / auto repeat scroll padding-box border-box #ffffff; border: 0.555556px solid #c7cdd1; clear: none; color: #24292e; cursor: auto; direction: ltr; font: 12px / 14.4px Monaco, Menlo, Consolas, 'Courier New', monospace; margin: 0px 0px 12px; padding: 9px; text-align: start; text-decoration: none solid #24292e; text-indent: 0px; white-space: pre-wrap; border-collapse: separate; border-spacing: 0px;" data-hljs-language="javascript"><code style="background: none 0% 0% / auto repeat scroll padding-box border-box rgba(0, 0, 0, 0); border: 0px none #24292e; font: 16px / 19.2px Monaco, Menlo, Consolas, 'Courier New', monospace; margin: 0px; padding: 0px;">server.<span style="border: 0px none #6f42c1; color: #6f42c1; text-decoration: none solid #6f42c1;">get</span>(<span style="border: 0px none #032f62; color: #032f62; text-decoration: none solid #032f62;">'/hello'</span>, <span>(<span>req, res</span>) =&gt;</span> {<br>  res.<span style="border: 0px none #6f42c1; color: #6f42c1; text-decoration: none solid #6f42c1;">json</span>(<span style="border: 0px none #032f62; color: #032f62; text-decoration: none solid #032f62;">`hello, <span style="border: 0px none #24292e; color: #24292e; text-decoration: none solid #24292e;">${process.env.FRIEND || <span style="border: 0px none #032f62; color: #032f62; text-decoration: none solid #032f62;">"my friend"</span>}</span>!`</span>);<br>});</code></pre>
</div>
<ul>
<li>Add the <span>FRIEND</span> to a <code>.env</code> file at the root of your project.</li>
</ul>
<pre style="background: none 0% 0% / auto repeat scroll padding-box border-box #ffffff; border: 0.555556px solid #c7cdd1; clear: none; color: #24292e; cursor: auto; direction: ltr; font: 12px / 14.4px Monaco, Menlo, Consolas, 'Courier New', monospace; margin: 0px 0px 12px; padding: 9px; text-align: start; text-decoration: none solid #24292e; text-indent: 0px; white-space: pre-wrap; border-collapse: separate; border-spacing: 0px;" data-hljs-language="xml"><code style="background: none 0% 0% / auto repeat scroll padding-box border-box rgba(0, 0, 0, 0); border: 0px none #24292e; font: 16px / 19.2px Monaco, Menlo, Consolas, 'Courier New', monospace; margin: 0px; padding: 0px;">FRIEND="Jess"</code></pre>
<ul>
<li><strong>Restart the server</strong> running on localhost.</li>
<li>Request the <code>/hello</code> endpoint on localhost to verify that the FRIEND property is set locally, either from the <code>.env</code> file or from the "<code><em>my friend</em></code>" fallback.</li>
<li>Commit and push to GitHub.</li>
<li>Once the new changes are deployed, refresh the application on Heroku. Note that we get the default "hello, my friend" message because the environment variable <strong>does not exist on Heroku</strong>.</li>
</ul>
<p><span>Now we are going to add that configuration variable on Heroku.</span></p>
<ul>
<li aria-level="1"><span>On Heroku, go to the "Settings" tab.</span></li>
<li aria-level="1"><span>Click on "Reveal Config Vars" in the "Config Vars" section.</span></li>
<li aria-level="1"><span>Add a FRIEND config var with the value <em>"Luke"</em></span></li>
<li aria-level="1"><span>Refresh the application.</span></li>
</ul>
<p><span>Note that the environment variable on Heroku overrides the default value set in the code, and overrides the value set in the local <code>.env</code> file (which is git-ignored and thus never pushed to GitHub nor deployed). We can use environment variables to store API keys, database connection information, and other secrets more securely.</span></p>
<h2 id="challenge">Challenge</h2>
<p><span>Using the information you've obtained from the guided project, create an application on Heroku to set up continuous deployment from one of your GitHub repositories.</span></p>
</body>
</html>